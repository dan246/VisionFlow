# VisionFlow CI/CD ä½¿ç”¨æŒ‡å—

é€™å€‹æ–‡ä»¶èªªæ˜å¦‚ä½•ä½¿ç”¨ VisionFlow å°ˆæ¡ˆçš„ CI/CD æµç¨‹ã€‚

## ğŸ“‹ ç›®éŒ„çµæ§‹

```
.github/
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ ci-cd.yml           # ä¸»è¦ CI/CD æµç¨‹
â”‚   â”œâ”€â”€ security-scan.yml   # å®‰å…¨æƒæ
â”‚   â””â”€â”€ release.yml         # ç™¼å¸ƒæµç¨‹
scripts/
â”œâ”€â”€ setup-dev.sh           # é–‹ç™¼ç’°å¢ƒè¨­ç½®
â”œâ”€â”€ deploy.sh             # éƒ¨ç½²è…³æœ¬
â””â”€â”€ monitor.sh            # ç›£æ§è…³æœ¬
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. è¨­ç½®é–‹ç™¼ç’°å¢ƒ

```bash
# åŸ·è¡Œé–‹ç™¼ç’°å¢ƒè¨­ç½®è…³æœ¬
./scripts/setup-dev.sh setup

# æˆ–æ‰‹å‹•è¨­ç½®
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pre-commit install
```

### 2. å•Ÿå‹•é–‹ç™¼æœå‹™

```bash
# å•Ÿå‹•é–‹ç™¼ç”¨è³‡æ–™åº«å’Œ Redis
./scripts/setup-dev.sh

# æˆ–ä½¿ç”¨ Docker Compose
docker-compose -f docker-compose.dev.yml up -d
```

### 3. éƒ¨ç½²æ‡‰ç”¨

```bash
# éƒ¨ç½²åˆ°é–‹ç™¼ç’°å¢ƒ
./scripts/deploy.sh deploy development

# éƒ¨ç½²åˆ°æ¸¬è©¦ç’°å¢ƒ
./scripts/deploy.sh deploy staging

# éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
./scripts/deploy.sh deploy production
```

## ğŸ”„ CI/CD æµç¨‹èªªæ˜

### åˆ†æ”¯ç­–ç•¥

- `main` - ç”Ÿç”¢åˆ†æ”¯ï¼Œè§¸ç™¼ç”Ÿç”¢éƒ¨ç½²
- `staging` - æ¸¬è©¦åˆ†æ”¯ï¼Œè§¸ç™¼æ¸¬è©¦ç’°å¢ƒéƒ¨ç½²
- `dev` - é–‹ç™¼åˆ†æ”¯ï¼Œè§¸ç™¼é–‹ç™¼ç’°å¢ƒéƒ¨ç½²
- `feature/*` - åŠŸèƒ½åˆ†æ”¯ï¼Œè§¸ç™¼ CI æª¢æŸ¥

### è‡ªå‹•è§¸ç™¼æ¢ä»¶

| äº‹ä»¶ | åˆ†æ”¯ | è§¸ç™¼çš„ä½œæ¥­ |
|------|------|-----------|
| Push | `main` | CI â†’ æ§‹å»º â†’ å®‰å…¨æƒæ â†’ ç”Ÿç”¢éƒ¨ç½² |
| Push | `staging` | CI â†’ æ§‹å»º â†’ æ•´åˆæ¸¬è©¦ â†’ æ¸¬è©¦éƒ¨ç½² |
| Push | `dev` | CI â†’ æ§‹å»º â†’ åŸºæœ¬æ¸¬è©¦ |
| Pull Request | ä»»ä½• | CI â†’ ä»£ç¢¼æª¢æŸ¥ â†’ æ¸¬è©¦ |
| Tag | `v*.*.*` | ç™¼å¸ƒæµç¨‹ â†’ æ§‹å»º Release |

### CI/CD éšæ®µ

#### 1. ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥
- ä»£ç¢¼æ ¼å¼æª¢æŸ¥ (Black, isort)
- ç¨‹å¼ç¢¼é¢¨æ ¼æª¢æŸ¥ (flake8)
- å®‰å…¨æ€§æƒæ (Bandit, Safety)
- å–®å…ƒæ¸¬è©¦åŸ·è¡Œ
- æ¸¬è©¦è¦†è“‹ç‡å ±å‘Š

#### 2. Docker æ˜ åƒæ§‹å»º
- å¤šæœå‹™ä¸¦è¡Œæ§‹å»º
- å¤šæ¶æ§‹æ”¯æ´ (amd64, arm64)
- æ˜ åƒå¿«å–å„ªåŒ–
- æ˜ åƒæ¨™ç±¤ç®¡ç†

#### 3. å®‰å…¨æƒæ
- ä¾è³´æ€§æ¼æ´æƒæ
- å®¹å™¨æ˜ åƒæƒæ (Trivy)
- ç¨‹å¼ç¢¼å®‰å…¨æƒæ

#### 4. æ•´åˆæ¸¬è©¦
- æœå‹™é–“æ•´åˆæ¸¬è©¦
- API ç«¯é»æ¸¬è©¦
- å¥åº·æª¢æŸ¥æ¸¬è©¦

#### 5. éƒ¨ç½²
- å¤šç’°å¢ƒéƒ¨ç½²æ”¯æ´
- æ»¾å‹•æ›´æ–°ç­–ç•¥
- è‡ªå‹•å›æ»¾æ©Ÿåˆ¶

## ğŸ› ï¸ æœ¬åœ°é–‹ç™¼å·¥ä½œæµç¨‹

### é–‹å§‹æ–°åŠŸèƒ½é–‹ç™¼

```bash
# 1. å»ºç«‹åŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature

# 2. è¨­ç½®é–‹ç™¼ç’°å¢ƒ
./scripts/setup-dev.sh

# 3. é–‹å§‹é–‹ç™¼...

# 4. åŸ·è¡Œæœ¬åœ°æ¸¬è©¦
./scripts/setup-dev.sh test

# 5. æäº¤ä»£ç¢¼ (pre-commit hooks æœƒè‡ªå‹•åŸ·è¡Œ)
git add .
git commit -m "feat: æ–°å¢åŠŸèƒ½æè¿°"

# 6. æ¨é€åˆ°é ç«¯
git push origin feature/new-feature

# 7. å»ºç«‹ Pull Request
```

### æœ¬åœ°æ¸¬è©¦

```bash
# ç¨‹å¼ç¢¼æ ¼å¼åŒ–
black .
isort .

# ç¨‹å¼ç¢¼æª¢æŸ¥
flake8 .

# å®‰å…¨æª¢æŸ¥
bandit -r .
safety check

# åŸ·è¡Œæ¸¬è©¦
pytest tests/ -v --cov=./

# æ•´åˆæ¸¬è©¦
docker-compose -f docker-compose.test.yml up -d
pytest tests/integration/ -v
```

## ğŸ“¦ éƒ¨ç½²ç®¡ç†

### ç’°å¢ƒé…ç½®

æ¯å€‹ç’°å¢ƒéƒ½æœ‰å°æ‡‰çš„ç’°å¢ƒæª”æ¡ˆï¼š
- `.env.dev` - é–‹ç™¼ç’°å¢ƒ
- `.env.staging` - æ¸¬è©¦ç’°å¢ƒ  
- `.env.prod` - ç”Ÿç”¢ç’°å¢ƒ

### éƒ¨ç½²å‘½ä»¤

```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
./scripts/deploy.sh status

# æŸ¥çœ‹æœå‹™æ—¥èªŒ
./scripts/deploy.sh logs

# å¥åº·æª¢æŸ¥
./scripts/deploy.sh health

# é‡å•Ÿæœå‹™
./scripts/deploy.sh restart [environment]

# åœæ­¢æœå‹™
./scripts/deploy.sh stop

# æ¸…ç†è³‡æº
./scripts/deploy.sh cleanup
```

### ç›£æ§å’Œæ—¥èªŒ

```bash
# åŸ·è¡Œå®Œæ•´ç›£æ§
./scripts/monitor.sh monitor

# å¯¦æ™‚ç›£æ§
./scripts/monitor.sh realtime

# ç”Ÿæˆç›£æ§å ±å‘Š
./scripts/monitor.sh report

# æ¸…ç†èˆŠæ—¥èªŒ
./scripts/monitor.sh cleanup 30
```

## ğŸ” å®‰å…¨æœ€ä½³å¯¦è¸

### ç’°å¢ƒè®Šæ•¸ç®¡ç†

1. ä¸è¦åœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼æ•æ„Ÿè³‡è¨Š
2. ä½¿ç”¨ GitHub Secrets ç®¡ç†ç”Ÿç”¢ç’°å¢ƒè®Šæ•¸
3. å®šæœŸæ›´æ–°å¯†ç¢¼å’Œ API é‡‘é‘°
4. ä½¿ç”¨å¼·å¯†ç¢¼å’ŒåŠ å¯†

### æ˜ åƒå®‰å…¨

1. å®šæœŸæ›´æ–°åŸºç¤æ˜ åƒ
2. æƒææ˜ åƒæ¼æ´
3. æœ€å°æ¬Šé™åŸå‰‡
4. ç§»é™¤ä¸å¿…è¦çš„å¥—ä»¶

### ç¶²è·¯å®‰å…¨

1. å•Ÿç”¨ HTTPS/TLS
2. è¨­ç½®é˜²ç«ç‰†è¦å‰‡
3. ä½¿ç”¨å®‰å…¨æ¨™é ­
4. é™åˆ¶ API å­˜å–é »ç‡

## ğŸ“Š ç›£æ§å’Œå‘Šè­¦

### å¥åº·æª¢æŸ¥ç«¯é»

æ¯å€‹æœå‹™éƒ½æ‡‰è©²æä¾›å¥åº·æª¢æŸ¥ç«¯é»ï¼š
- `GET /health` - åŸºæœ¬å¥åº·æª¢æŸ¥
- `GET /ready` - å°±ç·’æª¢æŸ¥
- `GET /metrics` - Prometheus æŒ‡æ¨™

### æ—¥èªŒç®¡ç†

- çµæ§‹åŒ–æ—¥èªŒæ ¼å¼
- é©ç•¶çš„æ—¥èªŒç­‰ç´š
- æ—¥èªŒè¼ªè½‰å’Œä¿ç•™
- é›†ä¸­åŒ–æ—¥èªŒæ”¶é›†

### æŒ‡æ¨™æ”¶é›†

- ç³»çµ±è³‡æºä½¿ç”¨ç‡
- æ‡‰ç”¨ç¨‹å¼æ•ˆèƒ½æŒ‡æ¨™
- æ¥­å‹™æŒ‡æ¨™
- éŒ¯èª¤ç‡å’Œå»¶é²

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **å®¹å™¨å•Ÿå‹•å¤±æ•—**
   ```bash
   # æª¢æŸ¥å®¹å™¨æ—¥èªŒ
   docker-compose logs [service_name]
   
   # æª¢æŸ¥æ˜ åƒæ˜¯å¦å­˜åœ¨
   docker images
   ```

2. **æœå‹™ç„¡æ³•é€£æ¥**
   ```bash
   # æª¢æŸ¥ç¶²è·¯é€£æ¥
   docker network ls
   docker network inspect [network_name]
   
   # æª¢æŸ¥ç«¯å£æ˜ å°„
   docker-compose ps
   ```

3. **è³‡æ–™åº«é€£æ¥å•é¡Œ**
   ```bash
   # æª¢æŸ¥è³‡æ–™åº«ç‹€æ…‹
   docker-compose exec db pg_isready
   
   # æª¢æŸ¥ç’°å¢ƒè®Šæ•¸
   docker-compose exec web env | grep POSTGRES
   ```

### èª¿è©¦æŠ€å·§

1. ä½¿ç”¨ `docker-compose exec` é€²å…¥å®¹å™¨èª¿è©¦
2. æª¢æŸ¥æ—¥èªŒæ–‡ä»¶çš„è©³ç´°éŒ¯èª¤è¨Šæ¯
3. ä½¿ç”¨å¥åº·æª¢æŸ¥ç«¯é»é©—è­‰æœå‹™ç‹€æ…‹
4. ç›£æ§è³‡æºä½¿ç”¨æƒ…æ³

## ğŸ“ æœ€ä½³å¯¦è¸

### Git å·¥ä½œæµç¨‹

1. ä½¿ç”¨æœ‰æ„ç¾©çš„æäº¤è¨Šæ¯
2. å°è€Œé »ç¹çš„æäº¤
3. ä»£ç¢¼å¯©æŸ¥æµç¨‹
4. ä¿æŒåˆ†æ”¯åŒæ­¥

### Docker æœ€ä½³å¯¦è¸

1. ä½¿ç”¨å¤šéšæ®µæ§‹å»º
2. æœ€å°åŒ–æ˜ åƒå¤§å°
3. é©ç•¶çš„æ¨™ç±¤ç­–ç•¥
4. å¥åº·æª¢æŸ¥é…ç½®

### æ¸¬è©¦ç­–ç•¥

1. å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%
2. æ•´åˆæ¸¬è©¦é—œéµè·¯å¾‘
3. æ€§èƒ½æ¸¬è©¦
4. å®‰å…¨æ¸¬è©¦

## ğŸ”— ç›¸é—œè³‡æº

- [Docker å®˜æ–¹æ–‡æª”](https://docs.docker.com/)
- [GitHub Actions æ–‡æª”](https://docs.github.com/en/actions)
- [Flask æœ€ä½³å¯¦è¸](https://flask.palletsprojects.com/en/2.0.x/)
- [PostgreSQL æ–‡æª”](https://www.postgresql.org/docs/)
- [Redis æ–‡æª”](https://redis.io/documentation)
